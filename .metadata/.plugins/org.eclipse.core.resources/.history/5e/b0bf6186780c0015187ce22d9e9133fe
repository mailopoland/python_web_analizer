'''
Created on 6 cze 2015

@author: user
'''
import urllib3, os.path
from settings.settings import Settings

class PageAnalizer():        
    
    # return 0: is OK (site was download before), 1: is OK (but site didn't was download before), any_other: return stauts of downloading error
    def download_site(self,site_url):
        self.site_url = site_url
        http = urllib3.PoolManager()
        r = http.request('GET', 'http://google.com/')
        if(r.status != 200):
            return r.status
        # save downloaded site
        self.cur_ver = r.data
        last_file = Settings().temp_dir() + site_url.replace('/','|') + "last"
        
        is_firt_exe = True
        # if we have last copy of this site (not first execute)
        if os.path.isfile(last_file):
            with open(last_file) as f:
                # save old version to variable
                self.last_ver = f.read().replace('\n', '')
            is_first_exe = False
        # overwrite last_file with current site version (for next daemon iteration)
        with open(last_file, "w+") as f:
            f.write(self.cur_ver)
        
        if(is_first_exe):
            return 1
        else:
            return 0
        
        
        